在ubuntu 20.04服务器上使用iptables开启端口转发服务的方法

为了科学上网，在国外弄了一个服务器做代理，为了安全起见，用国内的服务器做了一个中转，这需要使用linux端口转发功能。

首先，先确认服务器是否已开启转发，运行：
sysctl net.ipv4.ip_forward
# 如果已经启动则显示
> net.ipv4.ip_forward = 1
# 如果没有启动则显示(请按照下面步骤进行开启)
> net.ipv4.ip_forward = 0

echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.conf
sysctl -p

//设置 DNAT
iptables -t nat -A PREROUTING -p tcp –dport [本地端口号] -j DNAT –to-destination [目标IP:目标端口号]

//设置SNAT
iptables -t nat -A POSTROUTING -p tcp -d [目标IP] –dport [目标端口号] -j SNAT –to-source [本地服务器IP]



```bash
iptables -t nat -A PREROUTING -p tcp --dport 56001 -j DNAT --to-destination 140.82.4.54:56001
iptables -t nat -A PREROUTING -p udp --dport 56001 -j DNAT --to-destination 140.82.4.54:56001
iptables -t nat -A POSTROUTING -p tcp -d 140.82.4.54 --dport 56001 -j SNAT --to-source 175.178.233.67
iptables -t nat -A POSTROUTING -p udp -d 140.82.4.54 --dport 56001 -j SNAT --to-source 175.178.233.67

只允许某个IP通过
ufw allow from 175.178.233.67 to any port 56001
```
